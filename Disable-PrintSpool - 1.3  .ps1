<#
Script Changes ACL in the directory
Stop Service PrintSpooler Spooler
Changes StartupType to Disabled
#>

$ServerList = "$PSScriptRoot\Serverlist.csv"
$Transcriptlog = "$PSScriptRoot\Transcipt.txt"

Start-Transcript -Path $Transcriptlog -Force
Get-Date -Format "yyyy/MM/dd HH:mm" 

Try 
 { # Start Try  
   $ImportServerList = Import-Csv $ServerList -Encoding UTF8 | ForEach-Object { # Start Foreach 
    New-Object PsObject -Prop @{ # Start New-Object 
     ServerName = $_.ServerName } # End NewObject 
      Invoke-Command -ComputerName $_.ServerName -ErrorAction Continue -ScriptBlock  { # Start ScriptBlock  
       # Change ACL
       $Path = "C:\Windows\System32\spool\drivers"
       $Acl = Get-Acl $Path
       $Ar = New-Object  System.Security.AccessControl.FileSystemAccessRule("System", "Modify", "ContainerInherit, ObjectInherit", "None", "Deny")
       $Acl.AddAccessRule($Ar)
       Set-Acl $Path $Acl
       
       # Disable Service PrintSpooler
       Get-Service -Name Spooler | Stop-Service -Force | Set-Service -StartupType Disabled

   } # End ScriptBlock
  } # End Foreach       
 } # End Try

Catch
 { # Start Catch 
  Write-Warning -Message "## ERROR## " 
  Write-Warning -Message "## Script could not start ## " 
  Write-Warning $Error[0]
 } # End Catch

Stop-Transcript




  
